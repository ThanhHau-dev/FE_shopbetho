<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Nh√≥m ·∫¢nh</title>
    <style>
        .hidden {
            display: none;
        }

       .image-group img {
            width: 10%;
        }
    </style>
</head>
<body>

    <button id="addGroupBtn">Th√™m Nh√≥m ·∫¢nh</button>
    <button id="submitBtn">G·ª≠i D·ªØ Li·ªáu</button>
    
    <div id="imageGroups"></div> <!-- Ch·ª©a danh s√°ch nh√≥m ·∫£nh -->

    <!-- Template nh√≥m ·∫£nh, c√°i n√†y kh√¥ng hi·ªÉn th·ªã -->
    <template id="imageGroupTemplate">
        <div class="image-group">

            <!-- c√°i n√†y d√πng checkbox h·ªó tr·ª£ n√∫t x√≥a -->
            <input type="checkbox" class="group-checkbox" /> Ch·ªçn nh√≥m n√†y

            <!-- input n√†y d√πng ƒë·ªÉ duy·ªát file cho ·∫£nh ƒë·∫°i di·ªán -->
            <input type="file" class="image-input avatar-input" accept="image/*" hidden />
            <img class="addImgAvt" src="./Resource/img/add img.png" style="width: 10%;" />

            <div class="details">

                <!-- input n√†y d√πng ƒë·ªÉ duy·ªát file cho c√°c ·∫£nh chi ti·∫øt -->
                <input type="file" class="image-input detail-input" accept="image/*" multiple hidden />
                <img class="addImgDetail" src="./Resource/img/add img.png" style="width: 10%;" />
                <img class="addImgDetail" src="./Resource/img/add img.png" style="width: 10%;" />
                <img class="addImgDetail" src="./Resource/img/add img.png" style="width: 10%;" />
                <img class="addImgDetail" src="./Resource/img/add img.png" style="width: 10%;" />
            </div>
        </div>
    </template>

    <script>
        const addGroupBtn = document.getElementById("addGroupBtn"); // n√∫t th√™m nh√≥m ·∫£nh
        const submitBtn = document.getElementById("submitBtn"); // n√∫t g·ª≠i d·ªØ li·ªáu
        const imageGroups = document.getElementById("imageGroups"); // div ch·ª©a danh s√°ch nh√≥m ·∫£nh
        const template = document.getElementById("imageGroupTemplate"); // template layout

        // üü¢ Th√™m nh√≥m ·∫£nh m·ªõi
        addGroupBtn.addEventListener("click", () => {
            const clone = template.content.cloneNode(true);
            const group = clone.querySelector(".image-group");

            // G√°n s·ª± ki·ªán khi ch·ªçn ·∫£nh ƒë·∫°i di·ªán
            const avatarImg = group.querySelector(".addImgAvt");
            const avatarInput = group.querySelector(".avatar-input");

            avatarImg.addEventListener("click", () => avatarInput.click());
            avatarInput.addEventListener("change", (e) => {
                const file = e.target.files[0];
                if (file) avatarImg.src = URL.createObjectURL(file);
            });

            // G√°n s·ª± ki·ªán khi ch·ªçn ·∫£nh chi ti·∫øt
            const detailImgs = group.querySelectorAll(".addImgDetail");
            const detailInput = group.querySelector(".detail-input");

            detailImgs.forEach((img) => {
                img.addEventListener("click", () => detailInput.click());
            });

            detailInput.addEventListener("change", (e) => {
                const files = e.target.files;
                detailImgs.forEach((img, index) => {
                    if (files[index]) img.src = URL.createObjectURL(files[index]);
                });
            });

            imageGroups.appendChild(group);
        });

        // üü¢ G·ª≠i d·ªØ li·ªáu khi nh·∫•n "Submit"
        submitBtn.addEventListener("click", () => {
            let allGroups = document.querySelectorAll(".image-group");
            let formData = new FormData();

            allGroups.forEach((group, index) => {
                let avatarInput = group.querySelector(".avatar-input");
                let detailInput = group.querySelector(".detail-input");

                if (avatarInput.files[0]) {
                    formData.append(`groups[${index}][avatar]`, avatarInput.files[0]);
                }

                if (detailInput.files.length > 0) {
                    Array.from(detailInput.files).forEach((file, fileIndex) => {
                        formData.append(`groups[${index}][details][${fileIndex}]`, file);
                    });
                }
            });

            // üü¢ G·ª≠i d·ªØ li·ªáu ƒë·∫øn backend
            fetch("/upload", {
                method: "POST",
                body: formData,
            })
            .then(response => response.json())
            .then(data => console.log("D·ªØ li·ªáu g·ª≠i th√†nh c√¥ng:", data))
            .catch(error => console.error("L·ªói g·ª≠i d·ªØ li·ªáu:", error));
        });
    </script>

</body>
</html>
